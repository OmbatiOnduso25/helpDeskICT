<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report ICT Issue</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5">
    <h2 class="mb-4">Report ICT Support Issue</h2>

    <div id="client-alert" class="alert alert-danger d-none" role="alert"></div>

    <form method="POST" action="{{ url_for('submit_issue') }}" id="reportForm">

        {{ form.hidden_tag() if form is defined }}

        <!-- Room -->
        <div class="mb-3">
            <label for="room" class="form-label">Room Number</label>
            <input type="text" class="form-control" id="room" name="room" required autofocus>
        </div>

        <!-- Accordion for issues -->
        <div class="accordion mb-3" id="issueAccordion" aria-describedby="issue-help">
            <div id="issue-help" class="form-text mb-2">Choose one or more issues below, or use "Other" to describe a different issue.</div>

            {% macro issue_group(id, title, issues) %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-{{ id }}">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-{{ id }}" aria-expanded="false" aria-controls="collapse-{{ id }}">
                        {{ title }}
                    </button>
                </h2>
                <div id="collapse-{{ id }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ id }}"
                        data-bs-parent="#issueAccordion">
                    <div class="accordion-body">
                        {% for issue in issues %}
                        {% set safe_id = issue|replace(' ', '_')|replace('’', '')|replace("\"", '')|replace("'", '') %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="issues" value="{{ issue }}"
                                    id="{{ safe_id }}">
                            <label class="form-check-label" for="{{ safe_id }}">{{ issue }}</label>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endmacro %}

            {{ issue_group('network', ' Network & Connectivity', [
                "No internet access", "Slow internet connection", "Cannot connect to WiFi",
                "LAN port not working", "IP conflict detected", "Network cable issue"]) }}

            {{ issue_group('printing', ' Printing & Scanning', [
                "Printer not working", "Printer out of paper/ink", "Cannot print from my PC",
                "Scanner not responding", "Print queue stuck"]) }}

            {{ issue_group('computer', ' Computer Issues', [
                "Computer won’t start", "Slow performance", "Frequent freezing/crashing",
                "Blue screen (BSOD)", "Unexpected restart", "Overheating"]) }}

            {{ issue_group('software', ' Software & Applications', [
                "Application not launching", "License/activation issue", "Error when opening software",
                "Software update needed", "Microsoft Office problems", "Antivirus issue"]) }}

            {{ issue_group('login', ' Login & Authentication', [
                "Forgot password", "Cannot log in to system", "Account locked",
                "Two-factor authentication issue", "Email access issue"]) }}

            {{ issue_group('file', ' File & Storage', [
                "Unable to access shared folder", "File deleted or missing",
                "Low disk space warning", "Backup failed"]) }}

            {{ issue_group('hardware', ' Hardware & Peripherals', [
                "Mouse/keyboard not working", "Monitor/display issue", "USB ports not detecting devices",
                "Projector/display not working", "Audio not working (no sound)", "Webcam not working"]) }}

            {{ issue_group('comm', ' Communication Tools', [
                "Zoom/Teams not working", "Mic not detected", "Camera not working in meetings",
                "Can't join online class/meeting"]) }}

            {{ issue_group('web', ' Web & Online Services', [
                "Website not opening", "VPN not connecting", "Proxy/server settings issue",
                "Online form or portal not loading"]) }}

            {{ issue_group('other', ' Other Requests', [
                "Request new hardware", "Request software installation", "General ICT enquiry"]) }}

        </div>

        <!-- Other free-text -->
        <div class="mb-3">
            <label class="form-label">Other (please specify)</label>
            <input type="text" class="form-control" name="other_issue" id="other_issue">
        </div>

        <!-- Details -->
        <div class="mb-3">
            <label for="details" class="form-label">Additional Details</label>
            <textarea class="form-control" id="details" name="details" rows="4" placeholder="Provide more information..."></textarea>
        </div>

        <button type="submit" class="btn btn-primary">Submit Issue</button>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  (function () {
    const form = document.getElementById('reportForm');
    const alertBox = document.getElementById('client-alert');

    function hasCheckedIssue() {
      const checks = form.querySelectorAll('input[type="checkbox"][name="issues"]');
      for (let c of checks) {
        if (c.checked) return true;
      }
      return false;
    }

    form.addEventListener('submit', function (e) {
      const otherVal = (document.getElementById('other_issue') || {}).value || '';
      if (!hasCheckedIssue() && otherVal.trim() === '') {
        e.preventDefault();
        alertBox.textContent = 'Please select at least one issue or fill the "Other" field.';
        alertBox.classList.remove('d-none');
        alertBox.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => { alertBox.classList.add('fade'); }, 10);
        return false;
      }
      alertBox.classList.add('d-none');
      return true;
    });
  })();
</script>
</body>
</html>
